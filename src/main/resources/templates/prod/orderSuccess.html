<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>주문완료</title>
    <link rel="stylesheet" href="/css/orderSuccess.css">
    <link rel="stylesheet" href="/css/common.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src=""></script>
</head>
<body>
    <header class="header">
        <div class="header_top">
            <ul class="header_semi_menu">
                <li><a href="#">고객센터</a></li>
                <li><a href="#">알림</a></li>
                <li><a href="#">로그인</a></li>
            </ul>
        </div>
        <div class="header_bottom">
            <div class="logo_box">
                <img src="/img/logo.png" alt="logo">
            </div>
            <div class="drop_menu">
                <ul class="e_drop">
                    <li>
                        <a href="#" class="default_m">CLOTHING</a>
                        <a href="#" class="hover_m">의류</a>
                    </li>
                    <li>
                        <a href="#" class="default_m">GAMES</a>
                        <a href="#" class="hover_m">게임</a>
                    </li>
                    <li>
                        <a href="#" class="default_m">APPLIANCES</a>
                        <a href="#" class="hover_m">가전제품</a>
                    </li>
                    <li>
                        <a href="#" class="default_m">ELECTRONICS</a>
                        <a href="#" class="hover_m">전자기기</a>
                    </li>
                </ul>
            </div>
            <div class="sub_icon">
                <img src="/img/mypage_icon.png" alt="my_page">
                <img src="/img/mycart_icon.png" alt="my_cart">
            </div>
        </div>
    </header>
    <section class="section">
        <div class="order-container">
            <img src="/img/success.png" alt="주문완료">
            <p>주문이 완료 되었습니다.</p>
            <p>잠시 후 결제내역 페이지로 이동합니다.</p>
        </div>
    </section>
    <footer class="footer">
        <div class="footer_wrap">
            <div class="footer_top">
                <ul class="f_flex f_top_ul">
                    <li><a href="#" class="f_single">개인정보처리방침</a></li>
                    <li><a href="#" class="f_notice">이용안내</a></li>
                </ul>
            </div>
            <div class="footer_mid">
                <ul class="f_flex">
                    <li>상호명 : (주)REWRITE</li>
                    <li>대표자 : 따악코</li>
                    <li>주소 : 서울시 강남구 테헤란로7길 에스코빌딩</li>
                    <li>전화번호 : 1234-5678</li>
                    <li>팩스 : 02-9876-5432</li>
                    <li>이메일 : rewrite@rewrite.com</li>
                </ul>
            </div>
            <div class="footer_mid_sec">
                <ul class="f_flex f_mid_sub">
                    <li>사업자등록번호 : 202-50410</li>
                    <li>통신판매업신고 : 제25-0410호</li>
                </ul>
            </div>
            <div class="footer_mid_thd">
                <ul>
                    <li></li>
                </ul>
            </div>
            <div class="footer_bottom">
                <p class="f_flex">Copyright © 2025 Jongsu Macne. All rights reserved. Created by JongSu</p>
            </div>
        </div>
    </footer>

    <script>
        // 쿼리 파라미터 값을 서버로 전달해 결제 요청할 때 보낸 데이터와 동일한지 반드시 확인하세요.
        const urlParams = new URLSearchParams(window.location.search);

        // 서버로 결제 승인에 필요한 결제 정보를 보내세요.
        async function confirmPayment() {
            const userId = /*[[${userId}]]*/ null;
            var requestData = {
                paymentKey: urlParams.get("paymentKey"),
                orderId: urlParams.get("orderId"),
                amount: urlParams.get("amount"),
            };

            try {
                const response = await fetch("/confirm/payment?uid=" + userId, {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify(requestData),
                });

                const json = await response.json();

                if (!response.ok) {
                    throw { message: json.message, code: json.code };
                }

                // 결제 성공 처리
                console.log('결제가 성공적으로 완료되었습니다.');

                // 3초 후 주문내역 페이지로 이동 (선택사항)
                setTimeout(() => {
                    window.location.href = '/prod/orderList';
                }, 3000);

                return json;
            } catch (error) {
                console.error('결제 처리 중 오류가 발생했습니다:', error);
                alert('결제 처리 중 오류가 발생했습니다. 고객센터에 문의해주세요.');
            }
        }

        // 페이지 로드 시 자동으로 결제 확인 요청
        document.addEventListener('DOMContentLoaded', confirmPayment);


    </script>
</body>
</html>