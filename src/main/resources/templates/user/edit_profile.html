<link rel="stylesheet" href="/css/user/edit_profile.css" />

<th:block th:replace="~{/include/include :: def(~{::#wrap})}">
    <section id="wrap" class="section">
        <div class="profile-container">
            <h1>회원정보수정</h1>
            <div class="img">
                <img class="profileImg" src="/img/profileImg.png" alt="회원정보수정이미지" />
                <a href="javascript:void(0);" id="cameraIcon"><img class="profileImg" src="/img/camera.png" alt="회원정보수정이미지" /></a>
            </div>
            <p><a href="/address/detail">주소지 관리</a></p>
            <!-- 숨겨진 파일 선택 input -->
<!--            <input type="file" id="imgInput" accept="image/*" style="display: none;" />-->

            <form action="/user/modify" method="post" enctype="multipart/form-data">
                <input type="file" id="imgInput" name="profileImage" accept="image/*" style="display: none;" />
                <input type="text" name="nickname" th:value="${user.nickname}" placeholder="닉네임" /><br />
                <input type="text" name="password"  placeholder="비밀번호 변경" required/><br />
                <input type="text" name="eqpassword" placeholder="비밀번호 재입력" required /><br/>
                <div class="actions">
                    <p><a href="#" class="withdraw">회원탈퇴</a></p>
                </div>
                <button type="submit">수정하기</button>
            </form>

            <!-- 회원 탈퇴 처리를 위한 숨겨진 폼 -->
            <form id="delete-form" action="/user/delete" method="post" style="display: none;"></form>
        </div>
        <div id="flash-message" th:if="${message}" th:text="${message}" style="display: none;"></div>
    </section>
</th:block>
<script src="/js/upload.js"></script>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        const flashMessage = document.getElementById("flash-message");
        if (flashMessage && flashMessage.textContent.trim() !== "") {
            alert(flashMessage.textContent); // 메시지를 알림으로 표시
        }
    });

    // 카메라 아이콘 클릭 시 파일 선택 창 열기
    const cameraIcon = document.getElementById("cameraIcon");
    const imgInput = document.getElementById("imgInput");

    cameraIcon.addEventListener("click", function() {
        imgInput.click(); // 숨겨진 파일 입력 요소 클릭
    });

    // 파일이 선택되었을 때 프로필 이미지 미리보기
    imgInput.addEventListener("change", function() {
        if (this.files && this.files[0]) {
            const reader = new FileReader();
            reader.onload = function(e) {
                const profileImg = document.querySelector(".profileImg:first-child");
                profileImg.src = e.target.result;
            };
            reader.readAsDataURL(this.files[0]);
        }
    });

    var deleteTrigger = document.querySelector(".withdraw");
    deleteTrigger.addEventListener("click", function (event) {
        event.preventDefault(); // a 태그의 기본 동작(페이지 이동) 방지

        if (confirm("정말로 탈퇴하시겠습니까?")) {
            // 서버 응답 전에 '삭제되었습니다' 알림을 띄우는 것은 좋지 않습니다.
            // 삭제 성공 후 리다이렉트된 페이지에서 메시지를 보여주는 것이 일반적입니다.
            // alert("삭제 되었습니다."); <-- 이 줄은 삭제하거나 주석 처리하는 것이 좋습니다.

            // 숨겨진 폼을 찾아서 제출(submit)합니다.
            document.getElementById('delete-form').submit();
        }
    });
</script>